{
  "id": "traffic-generator-cli",
  "displayName": "Traffic Generator CLI",
  "description": "High-performance web traffic generator for load testing and performance validation of web applications and APIs.",
  "icon": "fas fa-tachometer-alt",
  "category": "Traffic Tools",
  "subCategory": "Load Generation", 
  "deploymentContext": "app",
  "image_id_ref": "traffic-generator-cli-latest",
  "taskLifecycle": "stateful",

  "deployment": {
    "container_command_template": [
      "python", "-m", "uvicorn", "container_control_core:app",
      "--host", "0.0.0.0", "--port", "8080"
    ],
    "fixed_ports": [8080],
    "default_env_vars": [
      {
        "name": "TARGET_URL",
        "label": "Target URL",
        "type": "string",
        "required": true,
        "tooltip": "Complete URL to test (e.g., https://example.com/api/endpoint)",
        "default_value": "https://httpbin.org/get"
      },
      {
        "name": "METHOD",
        "label": "HTTP Method",
        "type": "select",
        "required": true,
        "default_value": "GET",
        "options": [
          {"value": "GET", "label": "GET"},
          {"value": "POST", "label": "POST"},
          {"value": "PUT", "label": "PUT"},
          {"value": "DELETE", "label": "DELETE"},
          {"value": "PATCH", "label": "PATCH"},
          {"value": "HEAD", "label": "HEAD"},
          {"value": "OPTIONS", "label": "OPTIONS"}
        ],
        "tooltip": "HTTP method to use for requests"
      },
      {
        "name": "CONCURRENT_USERS",
        "label": "Concurrent Users",
        "type": "integer",
        "required": true,
        "default_value": 10,
        "min": 1,
        "max": 10000,
        "tooltip": "Number of concurrent virtual users"
      },
      {
        "name": "REQUESTS_PER_SECOND",
        "label": "Target RPS",
        "type": "integer",
        "required": false,
        "default_value": 100,
        "min": 1,
        "max": 100000,
        "tooltip": "Target requests per second (0 = unlimited)"
      },
      {
        "name": "DURATION_SECONDS",
        "label": "Duration (seconds)",
        "type": "integer",
        "required": false,
        "default_value": 300,
        "min": 1,
        "max": 86400,
        "tooltip": "Test duration in seconds (0 = infinite)"
      },
      {
        "name": "RAMP_UP_SECONDS",
        "label": "Ramp Up Time (seconds)",
        "type": "integer",
        "required": false,
        "default_value": 30,
        "min": 0,
        "max": 3600,
        "tooltip": "Time to gradually reach target load"
      },
      {
        "name": "REQUEST_BODY",
        "label": "Request Body",
        "type": "string",
        "ui_type": "json_textarea",
        "required": false,
        "tooltip": "JSON request body for POST/PUT requests",
        "default_value": ""
      },
      {
        "name": "HEADERS",
        "label": "Custom Headers",
        "type": "string",
        "ui_type": "json_textarea",
        "required": false,
        "tooltip": "JSON object with custom HTTP headers",
        "default_value": "{\"Content-Type\": \"application/json\"}"
      },
      {
        "name": "SITEMAP_JSON",
        "label": "URL Sitemap",
        "type": "string",
        "ui_type": "sitemap_select",
        "required": false,
        "tooltip": "JSON array of URLs to test in rotation",
        "default_value": "[]"
      },
      {
        "name": "ENABLE_COOKIES",
        "label": "Enable Cookies",
        "type": "boolean",
        "required": false,
        "default_value": true,
        "tooltip": "Maintain cookies across requests"
      },
      {
        "name": "FOLLOW_REDIRECTS",
        "label": "Follow Redirects",
        "type": "boolean",
        "required": false,
        "default_value": true,
        "tooltip": "Automatically follow HTTP redirects"
      },
      {
        "name": "VERIFY_SSL",
        "label": "Verify SSL Certificates",
        "type": "boolean",
        "required": false,
        "default_value": true,
        "tooltip": "Verify SSL/TLS certificates"
      },
      {
        "name": "TIMEOUT_SECONDS",
        "label": "Request Timeout (seconds)",
        "type": "integer",
        "required": false,
        "default_value": 30,
        "min": 1,
        "max": 300,
        "tooltip": "Timeout for individual requests"
      },
      {
        "name": "DEBUG",
        "label": "Debug Mode",
        "type": "boolean",
        "required": false,
        "default_value": false,
        "tooltip": "Enable verbose logging and debug output"
      }
    ]
  },

  "containerControl": {
    "enabled": true,
    "api_port_fixed": 8080,
    "metrics_endpoint_path": "/api/metrics",
    "actions": {
      "start": {
        "endpoint": "/api/start",
        "method": "POST",
        "payload_template_type": "custom",
        "payload_template": {
          "target_url": "{{env.TARGET_URL}}",
          "method": "{{env.METHOD}}",
          "concurrent_users": "{{env.CONCURRENT_USERS}}",
          "requests_per_second": "{{env.REQUESTS_PER_SECOND}}",
          "duration_seconds": "{{env.DURATION_SECONDS}}",
          "ramp_up_seconds": "{{env.RAMP_UP_SECONDS}}",
          "request_body": "{{env.REQUEST_BODY | json_parse_optional}}",
          "headers": "{{env.HEADERS | json_parse}}",
          "sitemap": "{{env.SITEMAP_JSON | json_parse}}",
          "enable_cookies": "{{env.ENABLE_COOKIES}}",
          "follow_redirects": "{{env.FOLLOW_REDIRECTS}}",
          "verify_ssl": "{{env.VERIFY_SSL}}",
          "timeout_seconds": "{{env.TIMEOUT_SECONDS}}",
          "debug": "{{env.DEBUG}}"
        }
      },
      "stop": {
        "endpoint": "/api/stop",
        "method": "POST"
      },
      "update_config": {
        "endpoint": "/api/update",
        "method": "POST",
        "payload_template_type": "custom",
        "payload_template": {
          "concurrent_users": "{{env.CONCURRENT_USERS}}",
          "requests_per_second": "{{env.REQUESTS_PER_SECOND}}",
          "debug": "{{env.DEBUG}}"
        },
        "updatable_fields": ["CONCURRENT_USERS", "REQUESTS_PER_SECOND", "DEBUG"]
      }
    }
  },

  "capabilities": {
    "can_stop": true,
    "can_resume": true,
    "can_redeploy": true,
    "can_edit_while_running": true
  },

  "monitoring": {
    "prometheus": {
      "enabled": true,
      "scrape_path": "/metrics",
      "scrape_port_number": 8080
    },
    "grafana": {
      "dashboard_url_template": "/grafana/d/traffic-gen-{{task.id}}/traffic-generator-details"
    }
  },

  "ui": {
    "deployment_form_sections": [
      {
        "title": "Target Configuration",
        "fields": ["TARGET_URL", "METHOD", "SITEMAP_JSON"]
      },
      {
        "title": "Load Parameters",
        "fields": ["CONCURRENT_USERS", "REQUESTS_PER_SECOND", "DURATION_SECONDS", "RAMP_UP_SECONDS"]
      },
      {
        "title": "Request Configuration",
        "fields": ["REQUEST_BODY", "HEADERS", "TIMEOUT_SECONDS"]
      },
      {
        "title": "Options",
        "fields": ["ENABLE_COOKIES", "FOLLOW_REDIRECTS", "VERIFY_SSL", "DEBUG"]
      }
    ],
    "card_info_fields": [
      {
        "label": "Target URL",
        "source_type": "env_var",
        "source_name": "TARGET_URL"
      },
      {
        "label": "Method",
        "source_type": "env_var",
        "source_name": "METHOD"
      },
      {
        "label": "Concurrent Users",
        "source_type": "env_var",
        "source_name": "CONCURRENT_USERS"
      },
      {
        "label": "Target RPS",
        "source_type": "env_var",
        "source_name": "REQUESTS_PER_SECOND"
      }
    ],
    "card_primary_metric": {
      "label": "RPS",
      "source_path": "metrics.current_rps",
      "unit": "rps"
    },
    "card_secondary_metrics": [
      {
        "label": "Total Requests",
        "source_path": "metrics.total_requests",
        "unit": ""
      },
      {
        "label": "Success Rate",
        "source_path": "metrics.success_rate_percent",
        "unit": "%"
      },
      {
        "label": "Avg Response Time",
        "source_path": "metrics.avg_response_time_ms",
        "unit": "ms"
      },
      {
        "label": "Active Users",
        "source_path": "metrics.active_users",
        "unit": ""
      }
    ],
    "card_basic_metrics": [
      {
        "label": "CPU",
        "source_path": "container.cpu_percent",
        "unit": "%",
        "max_value": 100
      },
      {
        "label": "Memory",
        "source_path": "container.memory_percent",
        "unit": "%",
        "max_value": 100
      },
      {
        "label": "Network Out",
        "source_path": "network.bytes_sent_mbps",
        "unit": "Mbps"
      },
      {
        "label": "Network In",
        "source_path": "network.bytes_received_mbps",
        "unit": "Mbps"
      }
    ],
    "card_live_update_fields": ["CONCURRENT_USERS", "REQUESTS_PER_SECOND", "DEBUG"]
  }
}
